<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stack Visualizer - Software Systems Prep</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="graph-visualizer.css">
    <style>
        /* Stack Specific Styles */
        .stack-container {
            display: flex;
            flex-direction: column-reverse; /* Bottom up */
            align-items: center;
            width: 120px;
            min-height: 300px;
            border-left: 4px solid var(--border-color);
            border-right: 4px solid var(--border-color);
            border-bottom: 4px solid var(--border-color);
            border-radius: 0 0 8px 8px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            position: relative;
            margin: 0 auto;
        }

        .stack-item {
            width: 100%;
            height: 40px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--accent-color);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-bottom: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
            position: relative;
        }

        .stack-item.new { animation: slideDown 0.4s ease; background-color: var(--callout-green); color: black; }
        .stack-item.popped { animation: fadeOut 0.4s ease forwards; background-color: var(--callout-red); }
        .stack-item.peek { background-color: var(--callout-yellow); color: black; transform: scale(1.05); }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(50px); }
        }

        .pointer-arrow {
            position: absolute;
            left: -60px;
            font-weight: bold;
            color: var(--accent-color);
            transition: bottom 0.3s ease;
            display: flex;
            align-items: center;
        }
        .pointer-arrow::after { content: '‚Üí'; font-size: 20px; margin-left: 5px; }

        /* Memory View */
        .memory-view {
            display: flex;
            gap: 2px;
            margin-top: 20px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
            overflow-x: auto;
        }
        .mem-cell {
            width: 30px;
            height: 30px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .mem-cell.active { background-color: var(--accent-color); color: white; }

        /* Code Panel Styles */
        .split-view {
            display: flex;
            gap: 20px;
            height: 100%;
            min-height: 400px;
        }
        .canvas-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        .code-section {
            flex: 1;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 300px;
        }
        .code-header {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(255,255,255,0.05);
        }
        .algo-code {
            padding: 15px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-secondary);
            flex: 1;
        }
        .code-line { padding: 2px 5px; border-radius: 4px; }
        .code-line.active {
            background-color: rgba(250, 204, 21, 0.2);
            border-left: 3px solid #facc15;
            color: #facc15;
        }
        .ln { color: var(--text-muted); margin-right: 10px; user-select: none; }
        .kwd { color: #f472b6; } .com { color: #6b7280; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>üåë Software Systems</h1>
                <p>Stack Visualizer</p>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Back</div>
                <a href="../lms-dashboard.html" class="nav-item">‚Üê Course Curriculum</a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Controls</div>
                <div class="control-group">
                    <label>Value</label>
                    <input type="number" id="val-input" class="control-input" placeholder="Enter number..." value="10">
                    <button class="action-btn" onclick="executeOp('push')">Push</button>
                    <button class="action-btn" onclick="executeOp('pop')">Pop</button>
                    <button class="action-btn" onclick="executeOp('peek')">Peek</button>
                </div>
                <div class="control-group">
                    <button class="action-btn warning" onclick="resetStack()">Reset</button>
                </div>
            </div>
        </aside>

        <main class="main-content no-padding">
            <div class="viz-container">
                <div class="algo-toolbar">
                    <div id="status-text" style="font-family: monospace; color: var(--accent-color);">Ready. Stack is LIFO (Last-In, First-Out).</div>
                </div>
                
                <div class="split-view">
                    <!-- Left: Visualization -->
                    <div class="canvas-section" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                        <div style="position: relative;">
                            <div id="top-pointer" class="pointer-arrow" style="bottom: 10px; opacity: 0;">TOP</div>
                            <div id="stack-container" class="stack-container">
                                <!-- Items injected here -->
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; width: 100%; padding: 0 20px;">
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px;">Memory Representation (Slice/Array)</div>
                            <div id="memory-view" class="memory-view">
                                <!-- Memory cells -->
                            </div>
                        </div>
                    </div>

                    <!-- Right: Code Panel -->
                    <div class="code-section">
                        <div class="code-header">
                            <button class="action-btn" style="padding: 4px 10px; font-size: 0.8rem;" onclick="copyCode()">üìã Copy</button>
                            <div class="btn-group">
                                <button class="tab-btn active" onclick="switchLang('go')">Go</button>
                                <button class="tab-btn" onclick="switchLang('java')">Java</button>
                                <button class="tab-btn" onclick="switchLang('python')">Python</button>
                            </div>
                        </div>
                        <div id="code-display" class="algo-code"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // State
        let stack = [];
        let currentLang = 'go';
        let currentOp = 'push';
        const MAX_SIZE = 8;

        // DOM Elements
        const container = document.getElementById('stack-container');
        const memView = document.getElementById('memory-view');
        const pointer = document.getElementById('top-pointer');
        const statusText = document.getElementById('status-text');
        const input = document.getElementById('val-input');

        // Code Definitions
        const CODES = {
            push: {
                go: `func (s *Stack) Push(v int) {
    s.items = append(s.items, v)
    // Stack grows dynamically
}`,
                java: `public void push(int v) {
    stack.push(v);
    // Java Stack is synchronized
}`,
                python: `def push(self, v):
    self.items.append(v)
    # List works as stack`
            },
            pop: {
                go: `func (s *Stack) Pop() int {
    n := len(s.items)
    if n == 0 { return -1 }
    item := s.items[n-1]
    s.items = s.items[:n-1]
    return item
}`,
                java: `public int pop() {
    if (stack.isEmpty()) throw new EmptyStackException();
    return stack.pop();
}`,
                python: `def pop(self):
    if not self.items: return None
    return self.items.pop()`
            },
            peek: {
                go: `func (s *Stack) Peek() int {
    n := len(s.items)
    if n == 0 { return -1 }
    return s.items[n-1]
}`,
                java: `public int peek() {
    if (stack.isEmpty()) throw new EmptyStackException();
    return stack.peek();
}`,
                python: `def peek(self):
    if not self.items: return None
    return self.items[-1]`
            }
        };

        function init() {
            renderCode('push'); // Default view
            renderMemory();
        }

        async function executeOp(op) {
            renderCode(op);
            
            if (op === 'push') {
                const val = parseInt(input.value);
                if (isNaN(val)) return;
                if (stack.length >= MAX_SIZE) {
                    statusText.textContent = "Stack Overflow! (Visual limit reached)";
                    return;
                }
                
                // Step 1: Highlight Code
                highlightLine(1);
                statusText.textContent = `Pushing ${val}...`;
                await sleep(500);

                // Step 2: Add to Stack
                stack.push(val);
                const item = document.createElement('div');
                item.className = 'stack-item new';
                item.textContent = val;
                item.id = `item-${stack.length-1}`;
                container.appendChild(item); // Flex-reverse handles bottom-up
                
                highlightLine(2);
                updatePointer();
                renderMemory();
                statusText.textContent = `Pushed ${val}. Top is now index ${stack.length-1}.`;
                
                setTimeout(() => item.classList.remove('new'), 500);

            } else if (op === 'pop') {
                if (stack.length === 0) {
                    statusText.textContent = "Stack Underflow! Cannot pop empty stack.";
                    highlightLine(2); // Error check line
                    return;
                }

                // Step 1: Highlight
                highlightLine(1);
                statusText.textContent = "Popping top element...";
                await sleep(500);

                // Step 2: Animate Removal
                const item = document.getElementById(`item-${stack.length-1}`);
                if (item) item.classList.add('popped');
                
                highlightLine(3); // Get item
                await sleep(400);

                stack.pop();
                if (item) item.remove();
                
                highlightLine(4); // Resize
                updatePointer();
                renderMemory();
                statusText.textContent = "Element removed.";

            } else if (op === 'peek') {
                if (stack.length === 0) {
                    statusText.textContent = "Stack is empty.";
                    return;
                }
                highlightLine(3);
                const item = document.getElementById(`item-${stack.length-1}`);
                item.classList.add('peek');
                statusText.textContent = `Top element is ${stack[stack.length-1]}`;
                await sleep(1000);
                item.classList.remove('peek');
            }
        }

        function updatePointer() {
            if (stack.length === 0) {
                pointer.style.opacity = '0';
            } else {
                pointer.style.opacity = '1';
                // Calculate position: 10px padding + (index * (40px height + 5px margin)) + 20px offset
                const bottom = 10 + (stack.length - 1) * 45 + 20; 
                pointer.style.bottom = `${bottom}px`;
            }
        }

        function renderMemory() {
            memView.innerHTML = '';
            // Render fixed slots to show memory allocation
            for (let i = 0; i < MAX_SIZE; i++) {
                const cell = document.createElement('div');
                cell.className = `mem-cell ${i < stack.length ? 'active' : ''}`;
                cell.textContent = i < stack.length ? stack[i] : '';
                memView.appendChild(cell);
            }
        }

        function renderCode(op) {
            currentOp = op;
            const code = CODES[op][currentLang];
            const display = document.getElementById('code-display');
            display.innerHTML = '';
            
            const lines = code.split('\n');
            lines.forEach((line, i) => {
                const div = document.createElement('div');
                div.className = 'code-line';
                div.id = `line-${i+1}`;
                // Simple syntax highlighting
                let html = line
                    .replace(/\b(func|var|return|if|else|for|type|struct|public|void|def|class)\b/g, '<span class="kwd">$1</span>')
                    .replace(/\/\/.*/g, '<span class="com">$&</span>');
                div.innerHTML = `<span class="ln">${i+1}</span>${html}`;
                display.appendChild(div);
            });
        }

        function highlightLine(num) {
            document.querySelectorAll('.code-line').forEach(l => l.classList.remove('active'));
            const line = document.getElementById(`line-${num}`);
            if (line) line.classList.add('active');
        }

        function copyCode() {
            const code = CODES[currentOp][currentLang];
            navigator.clipboard.writeText(code);
        }

        function switchLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderCode('push'); // Reset to push view
        }

        function resetStack() {
            stack = [];
            container.innerHTML = '';
            updatePointer();
            renderMemory();
            statusText.textContent = "Stack reset.";
        }

        function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

        init();
    </script>
</body>
</html>